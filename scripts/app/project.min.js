var app=angular.module("project",["geodata","yotraFilters"]),wamsClient=new WindowsAzure.MobileServiceClient("https://rave-mobile.azure-mobile.net/","cJVLPsElKKsvBvtlYLKJwPgBzkFPmk65"),LoginPartialCtrl;localStorage.applicationKey=wamsClient.applicationKey,localStorage.version=wamsClient.version,console.log(wamsClient),LoginPartialCtrl=["$scope",function(n){localStorage.currentUser&&(n.currentUser=JSON.parse(localStorage.currentUser)),n.logOnWithFacebook=function(){wamsClient.login("facebook").then(function(n){localStorage.currentUser=JSON.stringify(n),location.reload()},function(n){console.log(n)})},n.logout=function(){console.log("logout"),wamsClient.logout(),localStorage.currentUser="",location.reload()}}],app.config(["$routeProvider",function(n){var t=["$scope","GeoData",function(n,t){n.geoForm={pointList:t.query()}}],i=["$scope","$location","GeoData",function(n,t,i){n.save=function(){var r=localStorage.currentUser?JSON.parse(localStorage.currentUser).mobileServiceAuthenticationToken:"testToken";i.save(n.project,function(){t.path("/geo")},function(n){alert(n)})}}],r=["$scope","GeoCoding","GeoRouting","GeoFeatureCollection",function(n,t,i,r){n.mapForm={name:"",fullName:"",lat:45,lon:.5};var u=L.map("map_leaflet").setView([n.mapForm.lat,n.mapForm.lon],5);L.tileLayer("http://{s}.tile.cloudmade.com/cf96818502834f14a74a10eabf87c129/997/256/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap<\/a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA<\/a>, Imagery © <a href="http://cloudmade.com">CloudMade<\/a>',maxZoom:18}).addTo(u),n.buildRouteList=function(){i.query({startLat:n.mapForm.lat,startLon:n.mapForm.lon,endLat:48,endLon:10},function(n){if(n.status>0)alert(n.status_message);else{var t=n.route_geometry;L.polyline(t,{color:"green"}).addTo(u)}},function(n){console.log("error"),console.log(n)})},n.getFeatureCollection=function(){r.query(function(n){var t=topojson.feature(n,n.objects.collection);console.log(t),L.geoJson(t).addTo(u)},function(n){console.log(n)})},n.findPlace=function(){t.query({q:n.mapForm.name},function(t){t.length>0?(n.mapForm.lat=t[0].lat,n.mapForm.lon=t[0].lon,u.setView([n.mapForm.lat,n.mapForm.lon],12)):alert("Place not found")},function(){alert("Error"),console.log("error"),console.log(p)})}}],u=["$scope",function(n){function i(n,i){if(myCollection.add(n.geoObjects),i===!0){console.log(myCollection.getLength());var r=new ymaps.GeoObjectCollection({},{});myCollection.each(function(n){n.each(function(n){var i=n.geometry.getCoordinates();ymaps.route([t.getCenter(),i]).then(function(n){r.add(n),console.log(r.getLength()),r.getLength()===23&&t.geoObjects.add(r)})})})}}function r(n){alert(n)}function u(n,t){ymaps.geoXml.load("http://maps.yandex.ua/export/usermaps/"+n+"/").then(function(n){i(n,t)},r)}var t;n.mapForm={isMapLoaded:!1},n.initialize=function(){ymaps.ready(function(){ymaps.geolocation||(ymaps.geolocation={latitude:55.76,longitude:37.64,zoom:10}),t=new ymaps.Map("map_yandex",{center:[ymaps.geolocation.latitude,ymaps.geolocation.longitude],zoom:5}),t.controls.add(new ymaps.control.ZoomControl),t.behaviors.enable(["scrollZoom","dblClickZoom"]),n.$$phase||n.$apply(function(){n.mapForm.isMapLoaded=!0});var i=new ymaps.GeoObject({geometry:{type:"Circle",coordinates:[ymaps.geolocation.latitude,ymaps.geolocation.longitude],radius:1e5}});t.geoObjects.add(i)})},n.findPlace=function(){n.mapForm.isMapLoaded===!0&&ymaps.geocode($scope.startPointName,{results:1}).then(function(n){var e=n.geoObjects.get(0),o,h,r,i,f,s;if(e!==null)for(o=e.geometry.getCoordinates(),t.setCenter(o,7,{duration:1}),h=new ymaps.GeoObjectCollection({},{preset:"twirl#brownStretchyIcon",geoObjectCursor:"point"}),r=["EraqyPO94sOvKxc6kNQ2XbMHO7EJJR0R","t3pjobj4S1hssyQjYPRKI1DGSCQkU9iI"],i=0,f=r.length;i<f;i+=1)s=i===f-1,u(r[i],s)})}}];n.when("/geo",{controller:t,templateUrl:"/geo.html"}).when("/create",{controller:i,templateUrl:"/create.html"}).when("/map-yandex",{controller:u,templateUrl:"/map-yandex.html"}).when("/map-leaflet",{controller:r,templateUrl:"/map-leaflet.html"}).otherwise({redirectTo:"/map-leaflet"})}]),app.run(function(){});
//@ sourceMappingURL=project.min.js.map